
<div class="message-list-item-tpl hide">
    <div class="message-row card">
        <div class="msg-item-header">
            <span class="chat-msg-time">${ctime}</span>
        </div>
        <div class="msg-item-content">
            ${html}
        </div>
    </div>
</div>

<div class="message-list">

</div>

<script type="text/javascript">
(function () {

    var LAST_DATE;

    function refreshMessageList(date) {
        LAST_DATE = date;
        var params = {
            date: date
        };

        $.get("/message/date", params,function (respText) {
            $(".message-list").html(respText);
        }).fail(function (e) {
            console.error(e);
            xnote.alert("调用接口失败");
        });
    };

    function doRefreshMessageList(params) {
        xnote.assert(typeof(params) == "object", "expect params to be object");
        xnote.assert(params.page, "params.page expected");
        xnote.assert(params.tag, "params.tag expected");

        params.format = "html";
        params.displayTag = getUrlParam("displayTag");

        $.get("/message/list", params, function (resp) {
            // console.log(resp);
            $(".message-list").html(resp);
        }).fail(function (e) {
            console.error(e);
            xnote.alert("调用接口失败，请重试");
        });
    }

    function onMessageReceived(event) {
        var data = event.data;
        if (data == "message.updated") {
            xnote.closeAllDialog();
            refreshMessageList(LAST_DATE);
        }
    }

    window.refreshMessageList = refreshMessageList;
    window.doRefreshMessageList = doRefreshMessageList;

    window.addEventListener("message", onMessageReceived, false);

})();
</script>