{% init can_edit = False %}


<div class="card">
    {% include "note/component/view_header.html" %}
</div>

<div class="card">
    {% include note/component/note_path.html %}
</div>

<div class="card col-md-12">
    {% if file.content == "" %}
        {% include common/text/empty_text.html %}
    {% end %}
    
    <div class="row">
        <div id="markdown-input-div" class="col-md-6 hide">
            <textarea id="markdown-input" class="form-control" name="content" rows=50>{{file.content}}</textarea>
        </div>

        <div id="markdown-output-div" class="col-md-12 markdown-output-div">

        </div>
    </div>
</div>

<script type="text/javascript">
    $(function () {
        
        function onCheckboxClicked(e) {
            // 按下单选项的行为
            var text = $(e.target).attr("data-text");
            console.log("onCheckboxClicked", text);
            var params = {};

            var newText = text.trimLeft();

            if (text.startsWith("[]")) {
                newText = "[x]" + newText.substring(2);
            }
            if (text.startsWith("[x]")) {
                newText = "[]" + newText.substring(3);
            }

            var oldContent = $("#markdown-input").val();
            // TODO: 先简单处理一下
            newContent = oldContent.replace(text, newText);
            params.id = "{{file.id}}";
            params.content = newContent;

            console.log("newContent:", newContent);

            $.post("/note/update", params, function (resp) {
                xnote.toast("更新成功，跳转中");
                window.location.reload();
            });
        }

        var input = $("#markdown-input").val();

        // 扩展选项
        var options = {};
        options.onCheckboxClicked = onCheckboxClicked;
        marked.parseAndRender(input, "#markdown-output-div", options);
    });
</script>
