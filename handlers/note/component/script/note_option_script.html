
<script type="text/javascript">
    function remove(id, name, parentId) {
        var confirmed = confirm("确定删除'" + name + "'?");
        if (confirmed) {
            $.post("/note/remove", {id:id}, function (resp) {
                var code = resp.code;
                if (code != "success") {
                    alert(resp.message);
                } else {
                    if (parentId) {
                        window.location.href = "/note/view?id="+parentId;
                    } else {
                        window.location.href = "/";
                    }
                }
            })
        }
    }

    function renameNote(id, oldName) {
        xnote.prompt("新名称", oldName, function (newName) {
            console.log(newName);
            if (newName != "" && newName != null) {
                $.post("/note/rename", {id:id, name:newName}, function (resp) {
                    var code = resp.code;
                    if (code != "success") {
                        alert(resp.message);
                    } else {
                        // $("#file-"+id).text(newName);
                        window.location.reload();
                    }
                })
            }
        });
    }

    function renameNoteByAttr(target) {
        var id = $(target).attr("data-id");
        var oldName = $(target).attr("data-name");
        if (id == undefined || id == "") {
            xnote.alert("data-id为空");
            return;
        }

        if (oldName == undefined || oldName == "") {
            xnote.alert("data-name为空");
            return;
        }

        renameNote(id, oldName);
    }

    function checkNotEmpty(object, message) {
        if (object === undefined || object === null || object === "") {
            xnote.alert(message);
            throw new Error(message);
        }
    }

    function call_xnote_api(api, params) {
        $.post(api, params, function (resp) {
            if (resp.code != "success") {
                xnote.alert(resp.message);
            } else {
                xnote.toast(resp.message);
                window.location.reload();
            }
        }).fail(function (error) {
            console.error(error);
            xnote.alert("接口调用失败:" + error.status + "," + error.statusText);
        })
    }

    $(function () {

        function onNoteRenameEvent(event) {
            console.log("rename");
            var target = event.target;
            renameNoteByAttr(target);
        }
        
        $(".rename-btn").click(function(event) {
            onNoteRenameEvent(event);
        });

        $(".note-rename-btn").click(function(event) {
            onNoteRenameEvent(event);
        });

        $(".status-btn").each(function (index, element) {
            var status = $(element).attr("data-status");
            if (status == "{{file.priority}}") {
                $(element).addClass("x-tab-btn-active");
            }
        });

        $(".status-btn").click(function(event) {
            var id = $(event.target).attr("data-id");
            var status = $(event.target).attr("data-status");

            checkNotEmpty(id, "data-id为空");
            checkNotEmpty(status, "data-status为空");

            $.post("/note/status", {id: id, status: status}, function (resp) {
                var code = resp.code;
                if (code != "success") {
                    xnote.alert(resp.message);
                } else {
                    xnote.toast(resp.message);
                    window.location.reload();
                }
            })
        });

        $(".status-select").change(function(event) {
            var id = $(event.target).attr("data-id");
            var status = $(event.target).val();

            checkNotEmpty(id, "data-id为空");
            checkNotEmpty(status, "data-status为空");

            $.post("/note/status", {id: id, status: status}, function (resp) {
                var code = resp.code;
                if (code != "success") {
                    xnote.alert(resp.message);
                } else {
                    xnote.toast(resp.message);
                    window.location.reload();
                }
            })
        });

        $(".orderby-btn").each(function (index, element) {
            var orderby = $(element).attr("data-orderby");
            if (orderby == "{{file.orderby}}") {
                $(element).addClass("x-tab-btn-active");
            }
        });

        $(".orderby-btn").click(function (event) {
            var id = $(event.target).attr("data-id");
            var orderby = $(event.target).attr("data-orderby");

            checkNotEmpty(id, "data-id为空");
            checkNotEmpty(orderby, "data-orderby为空");

            $.post("/note/orderby", {id: id, orderby: orderby}, function (resp) {
                var code = resp.code;
                if (code != "success") {
                    xnote.alert(resp.message);
                } else {
                    xnote.toast(resp.message);
                    window.location.reload();
                }
            })
        });

        $(".orderby-select").change(function (event) {
            var id = $(event.target).attr("data-id");
            var orderby = $(event.target).val();

            checkNotEmpty(id, "data-id为空");
            checkNotEmpty(orderby, "data-orderby为空");

            $.post("/note/orderby", {id: id, orderby: orderby}, function (resp) {
                var code = resp.code;
                if (code != "success") {
                    xnote.alert(resp.message);
                } else {
                    xnote.toast(resp.message);
                    window.location.reload();
                }
            })
        });

        $(".note-share-btn").click(function (event) {
            var id = $(event.target).attr("data-id");
            var params = {note_id: id};

            $.get("/note/ajax/share_group_dialog", params, function (resp) {
                xnote.showDialog("分享笔记本", resp);
            });

            // xnote.prompt("分享给", "", function (resp) {
            //     // xnote.toast(resp);
            //     call_xnote_api("/note/share", {id: id, share_to: resp});
            // })
        });
    })
</script>

